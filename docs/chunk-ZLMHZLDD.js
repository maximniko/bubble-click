import{a as H,c as w,d as b,e as J,f as K}from"./chunk-N6EJN5TU.js";import"./chunk-JXRJSF23.js";import{a as G}from"./chunk-S7XQ55JY.js";import{a as T}from"./chunk-KEZW3WUK.js";import{h as Y}from"./chunk-PGHGH7VN.js";import{a as z}from"./chunk-4W6JIO4F.js";import{$a as g,$b as V,Ha as s,Ia as u,Ua as h,Xb as P,Ya as D,_b as R,ab as $,ac as U,bb as j,cb as A,db as r,ea as B,eb as c,gb as F,gc as q,hb as L,ib as d,ma as E,mb as O,na as M,nb as p,ob as x,pb as v,qb as C,sb as W,ub as N,wb as S,xb as y,yb as k}from"./chunk-KV6LOXJG.js";var X=(i,t)=>({"bg-success":i,"bg-secondary":t}),Z=(i,t)=>({"btn-success":i,"btn-secondary":t});function ee(i,t){if(i&1&&(r(0,"span",14),p(1),c()),i&2){let e,o=d().$implicit,n=d(3);s(),C("+",(e=n.localisation.messages.bonus)!==null&&e!==void 0?e:"bonus"," ",n.depositToBonus(o),"")}}function te(i,t){if(i&1){let e=F();r(0,"li",6),W(1)(2),r(3,"div",7)(4,"div",8)(5,"div"),p(6),c(),r(7,"div"),p(8),c()(),r(9,"div",8)(10,"div"),p(11),c(),r(12,"div",9),p(13),c()()(),r(14,"div",10)(15,"div",11),p(16),y(17,"percent"),c()(),r(18,"div",12)(19,"div",13),p(20),h(21,ee,2,2,"span",14),c(),r(22,"button",15),L("click",function(){let n=E(e).$index,a=d(3);return M(a.take(n))}),p(23),c()()()}if(i&2){let e,o,n,a,m,_=t.$implicit,l=d(3),I=l._coefficient(_),f=l._canTake(_);s(6),C("",(e=l.localisation.messages.Contribution)!==null&&e!==void 0?e:"Contribution"," ",_.sum,""),s(2),C("",(o=l.localisation.messages.upTo)!==null&&o!==void 0?o:"up to"," ",l.toLocalDate(l.depositToDate(_),(o=l.twa.getUserLanguageCode())!==null&&o!==void 0?o:"en"),""),s(3),x((n=l.localisation.messages.income)!==null&&n!==void 0?n:"income"),s(2),v("",_.plan.percents,"%"),s(2),O("width:",l.Math.ceil(I*100),"%"),D("ngClass",S(17,X,f,!f)),s(),v("",k(17,15,I)," "),s(4),v(" ",(a=l.localisation.messages.WithdrawDeposit)!==null&&a!==void 0?a:"Withdraw deposit"," "),s(),g(f?21:-1),s(),D("ngClass",S(20,Z,f,!f)),s(),v(" ",(m=l.localisation.messages.Take)!==null&&m!==void 0?m:"Take"," ")}}function ie(i,t){if(i&1&&(r(0,"ul",5),j(1,te,24,23,"li",6,$),c()),i&2){let e=d();s(),A(e)}}function oe(i,t){if(i&1&&(r(0,"p"),p(1),c()),i&2){let e,o=d(2);s(),x((e=o.localisation.messages.NoDepositsYet)!==null&&e!==void 0?e:"No deposits yet.")}}function ne(i,t){i&1&&h(0,ie,3,0,"ul",5)(1,oe,2,1,"p"),i&2&&g(t.length?0:1)}var Q=class i{constructor(t,e,o,n,a){this.router=t;this.coinsService=e;this.depositService=o;this.twa=n;this.localisation=a;this.add=this.add.bind(this),this.goBack=this.goBack.bind(this)}_coefficient(t){return w(t)}_canTake(t){return w(t)*100>=100}take(t){let e=this.depositService.deposits[t];if(!e){this.twa.showAlert(this.localisation.messages.AlertCantFindDeposit??"'Can't find deposit'");return}let o=`${this.localisation.messages.WithdrawDeposit??"Withdraw deposit"} ${e.sum}`;this._canTake(e)&&(o+=` +${this.localisation.messages.bonus??"bonus"} ${b(e)}`);let n="yes";this.twa.showPopup({title:this.localisation.messages.WithdrawDeposit??"Withdraw deposit",message:`${o}?`,buttons:[{id:n,type:"ok"},{type:"cancel"}]},a=>{a===n&&this.takeDeposit(t)})}takeDeposit(t){let e=this.depositService.deposits,o=this.coinsService.balance,n=Array.from(e),a=e.splice(t,1)[0],m=a.sum;this._canTake(a)&&(m+=b(a));try{this.coinsService.saveBalance(o+m),this.depositService.saveDeposits(e)}catch{this.coinsService.saveBalance(o),this.depositService.saveDeposits(n)}}ngOnInit(){this.twa.setMainButton({text:this.localisation.messages.AddDeposit??"Add deposit",is_active:!0,is_visible:!0},this.add),this.twa.backButtonOnClick(this.goBack)}ngOnDestroy(){this.twa.offMainButton(this.add),this.twa.offBackButton(this.goBack)}goBack(){this.router.navigate([T.balance()])}add(){this.router.navigate([T.depositAdd()])}toLocalDate=H;depositToBonus=b;depositToDate=J;Math=Math;static \u0275fac=function(e){return new(e||i)(u(Y),u(G),u(K),u(q),u(z))};static \u0275cmp=B({type:i,selectors:[["ng-component"]],hostAttrs:[1,"d-flex","flex-column","h-100"],standalone:!0,features:[N],decls:8,vars:4,consts:[[1,"accent-border","accent-border-top","accent-bg-shadow","rounded-5","tg-bg-secondary"],[1,"hstack","p-3","pb-0","color-accent"],[1,"m-auto","text-center","h5"],[1,"mb-5"],[1,"mx-2","my-4","overflow-auto",2,"max-height","calc(var(--tg-viewport-stable-height, 200) * 0.7)"],[1,"list-group"],[1,"list-group-item","align-items-center"],[1,"d-flex","justify-content-around","my-2","text-center"],[1,"vstack","my-auto"],[1,"h2"],["role","progressbar",1,"progress"],[1,"progress-bar","progress-bar-striped","progress-bar-animated",3,"ngClass"],[1,"d-flex","justify-content-between","my-2"],[1,"m-auto"],[1,"color-accent"],[1,"btn",3,"click","ngClass"]],template:function(e,o){if(e&1&&(r(0,"section",0)(1,"div",1)(2,"span",2),p(3),c()(),r(4,"div",3)(5,"div",4),h(6,ne,2,1),y(7,"async"),c()()()),e&2){let n,a;s(3),x((n=o.localisation.messages.Deposits)!==null&&n!==void 0?n:"Deposits"),s(3),g((a=k(7,2,o.depositService.depositsSubject))?6:-1,a)}},dependencies:[U,P,R,V],encapsulation:2})};export{Q as DepositComponent};
