import{a as P,b as $}from"./chunk-7I22RIBK.js";import{a as D}from"./chunk-OIFQLSBG.js";import{a as U}from"./chunk-ATKTSN4Z.js";import"./chunk-JXRJSF23.js";import{a as V}from"./chunk-S7XQ55JY.js";import{a as N}from"./chunk-4W6JIO4F.js";import{$a as B,Ha as r,Ia as m,Ua as C,Xa as h,Xb as O,Ya as v,ac as A,bb as w,cb as I,db as c,e as R,ea as S,eb as s,fb as f,gb as E,gc as M,hb as k,ib as l,ma as _,na as T,nb as a,oa as d,ob as p,pa as y,pb as b,qb as j,sb as F,ub as L,vb as g}from"./chunk-KV6LOXJG.js";var H=R(U());var q=(o,e)=>e.level,z=o=>({"bg-success-subtle":o}),J=o=>({disabled:o});function K(o,e){if(o&1&&(c(0,"span",12),a(1),s()),o&2){let t,i=l(2);r(),p((t=i.localisation.messages.Bought)!==null&&t!==void 0?t:"Bought")}}function Q(o,e){if(o&1){let t=E();c(0,"button",14),k("click",function(){_(t);let n=l().$implicit,u=l();return T(u.confirmByCoin(n))}),a(1),s()}if(o&2){let t,i=l().$implicit,n=l();v("ngClass",g(2,J,!n.canBuy(i))),r(),p((t=n.localisation.messages.Buy)!==null&&t!==void 0?t:"Buy")}}function W(o,e){if(o&1&&(F(0),c(1,"li",6)(2,"div",7)(3,"h3",8),a(4),s(),c(5,"div")(6,"span",9),a(7),s(),a(8),s()(),c(9,"div",10)(10,"div",11),d(),c(11,"svg",3),f(12,"use"),s(),a(13),s(),C(14,K,2,1,"span",12)(15,Q,2,4,"button",13),s()()),o&2){let t,i,n=e.$implicit,u=l(),x=u.bought(n);r(),v("ngClass",g(8,z,x)),r(3),j("",(t=u.localisation.messages.Level)!==null&&t!==void 0?t:"Level"," ",n.level,""),r(3),p(n.perClick),r(),b(" ",(i=u.localisation.messages.perClick)!==null&&i!==void 0?i:"per click",""),r(4),h("href","#"+u.symbols.coin,null,"xlink"),r(),b(" ",n.coins.now," "),r(),B(x?14:15)}}var G=class o{constructor(e,t,i,n){this.twa=e;this.coinsService=t;this.turboService=i;this.localisation=n}coinsSubscription;turboSubscription;maxSum=0;boughtTurbo=[];turbo;ngOnInit(){this.coinsSubscription=this.coinsService.balanceSubject.subscribe({next:e=>{this.maxSum=e,this.onNextBalance(e)},error:e=>this.twa.showAlert(e.message)}),this.turboSubscription=this.turboService.turbosSubject.subscribe(e=>this.boughtTurbo=e)}ngOnDestroy(){this.coinsSubscription?.unsubscribe(),this.turboSubscription?.unsubscribe()}bought(e){return!!this.boughtTurbo.find(t=>t.level==e.level)}canBuy(e){return(this.boughtTurbo.sort((t,i)=>t.level>i.level?-1:1)[0]?.level??0)+1==e.level&&this.maxSum>e.coins.now}confirmByCoin(e){this.twa.showPopup({title:this.localisation.messages.PopupTurboBuyTitle??"Buy a turbo?",message:(0,H.sprintf)(this.localisation.messages.PopupTurboBuyContent??"Buy turbo %d level for %d?",e.level,e.coins.now),buttons:[{id:"yes",type:"default",text:this.localisation.messages.Buy??"Buy"},{type:"cancel"}]},t=>{t==="yes"&&this.byCoin(e)})}byCoin(e){this.canBuy(e)&&(this.turbo=e,this.coinsService.loadBalance())}onNextBalance(e){let t=this.turbo?.coins.now;if(!this.turbo||!t)return;if(e<t){this.twa.showAlert(this.localisation.messages.AlertBalanceError??"Balance error!");return}let i=Array.from(this.boughtTurbo);i.push(this.turbo),this.turbo=void 0;try{this.coinsService.saveBalance(e-t),this.turboService.saveTurbos(i)}catch(n){this.twa.showAlert(n.message),this.coinsService.saveBalance(e),this.turboService.saveTurbos(this.boughtTurbo)}}symbols=D;turbos=P;static \u0275fac=function(t){return new(t||o)(m(M),m(V),m($),m(N))};static \u0275cmp=S({type:o,selectors:[["ng-component"]],hostAttrs:[1,"d-flex","flex-column","h-100"],standalone:!0,features:[L],decls:10,vars:2,consts:[[1,"accent-border","accent-border-top","accent-bg-shadow","rounded-5","tg-bg-secondary","h-100"],[1,"hstack","p-3","color-accent"],[1,"m-auto","text-center","h5"],[1,"bi"],[1,"overflow-auto",2,"max-height","calc(var(--tg-viewport-stable-height, 200) * 0.7)"],[1,"list-group","m-2","my-3","tg-bg-secondary"],[1,"list-group-item","vstack",3,"ngClass"],[1,"jcb"],[1,"h3"],[1,"color-accent","h3"],[1,"jcb","gap-2","text-center"],[1,"color-accent","my-2","h4"],[1,"btn","btn-success","disabled"],[1,"btn","tg-btn",3,"ngClass"],[1,"btn","tg-btn",3,"click","ngClass"]],template:function(t,i){if(t&1&&(c(0,"section",0)(1,"div",1)(2,"span",2),d(),c(3,"svg",3),f(4,"use"),s(),a(5),s()(),y(),c(6,"div",4)(7,"ul",5),w(8,W,16,10,"li",6,q),s()()()),t&2){let n;r(4),h("href","#"+i.symbols.rocketTakeoff,null,"xlink"),r(),b(" ",(n=i.localisation.messages.Turbo)!==null&&n!==void 0?n:"Turbo"," "),r(3),I(i.turbos)}},dependencies:[A,O],encapsulation:2})};export{G as TurboComponent};
