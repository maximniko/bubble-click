import{a as f}from"./chunk-JXRJSF23.js";import{Y as c,ba as s,gc as m,i as a,jc as n,lc as u,m as p,mc as D}from"./chunk-KV6LOXJG.js";function T(o,e,t={month:"short",day:"numeric"}){return o.toLocaleDateString(e,t)}function l(o){let e=String(o.getUTCMonth()+1),t=String(o.getUTCDate());return e.length<2&&(e="0"+e),t.length<2&&(t="0"+t),`${o.getFullYear()}-${e}-${t}`}function d(o,e){return Math.floor(Math.abs(e.getTime()-o.getTime())/(1e3*3600*24))}var b=[{id:1,days:1,percents:1},{id:2,days:3,percents:4},{id:3,days:6,percents:9},{id:4,days:9,percents:14},{id:5,days:12,percents:23},{id:6,days:18,percents:33}];function S(o){return d(o.fromDate,new Date)/o.plan.days}function w(o){let e=S(o),t=o.sum*o.plan.percents/100;return Math.ceil(e*t)}function P(o){return new Date(o.fromDate.getTime()+o.plan.days*24*3600*1e3)}var g=class o{constructor(e,t){this.twa=e;this.cloudStorage=t;this.loadDeposits()}depositsSubject=new p([]);_deposits=[];get deposits(){return this._deposits}set deposits(e){this._deposits=e,this.depositsSubject.next(e)}saveDeposits(e,t){if(!this.canSave(e))throw new Error("Too many deposits.");this.cloudStorage.setItem(n,this.depositsToValue(e)).subscribe({next:r=>{r&&(this.deposits=e)},error:r=>{if(r)throw new Error(r)},complete:()=>{t&&t(new a(r=>r.next()))}})}depositsToValue(e){return JSON.stringify(e.map(t=>[t.plan.id,l(t.fromDate),t.sum]))}valueToDeposits(e){let t=f(e);if(!t)return[];let r=b;return t.map(i=>({plan:r.find(h=>h.id==i[0]),fromDate:new Date(i[1]),sum:i[2]}))}loadDeposits(e){this.cloudStorage.getItem(n).subscribe({next:t=>{t?this.deposits=this.valueToDeposits(t):this.deposits=[]},error:t=>{t&&this.twa.showAlert(t)},complete:()=>{e?.()}})}canSave(e){return this.depositsToValue(e).length<u}static \u0275fac=function(t){return new(t||o)(s(m),s(D))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{T as a,b,S as c,w as d,P as e,g as f};
